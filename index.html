<!DOCTYPE html>
<html>
<head>
	
	<script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
 <title>Shadows in the Rain</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
   <link rel="stylesheet" href="css/style.css" />
   
</head>
   
<body>
    <div id="map" style="width: 80vw; height: 80vh"></div>
<script type="text/javascript" src="js/script.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
   <script src="http://d3js.org/d3.v3.min.js"></script>
   
    <script>
      var map = L.map('map').setView([38.8833,-97.0167], 3);
       var hdat=null;
        
        var flag=true;
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            id: 'mapbox.streets',
           continuousWorld: 'true',
           noWrap: 'true'
        }).addTo(map);
       
      var speed=200;
      var polyline = L.polyline([]).addTo(map)
      var latvalues=[];
        var lngvalues=[];
        var pointsAdded = 0;
  /*  $(".submit").click(function(){
	// 2. You can also call this function anytime you want to update the data.
	ajax_call();
});*/
function ajax_call() {

	var xmlhttp=false;
	if (!xmlhttp && typeof XMLHttpRequest!='undefined') {
	  xmlhttp = new XMLHttpRequest();
	}
	// 3. You can send the query parameters here. We shall use the controls to do the same.
	var text = $("#text").val();
	// 4. We're passing the required parameters to the PHP file here via GET method. In this case, the PHP file is getData.php
	var query = "getData.php?query="+text;
	//alert(query); // 5. Alerting the samply query. Queries don't work yet. Follow getData.php for the next step.
	xmlhttp.open("GET", query, true);
	xmlhttp.onreadystatechange=function() {
		if (xmlhttp.readyState==4) {

			// 13. Here's the JSON response that you get.
			alert(xmlhttp.responseText);
			 var var_ret = JSON.parse(xmlhttp.responseText);
			console.log(var_ret);
		

		var polyline = L.polyline([]).addTo(map);
		var pointsadded = 0;
		var latvalues = [];
		var lngvalues = [];
		for(i=0;i<var_ret[0].length;i++)
		{
		latvalues.push(+var_ret[0][i]);
        
        lngvalues.push(0-var_ret[1][i]);          
		}
		console.log(latvalues);
		console.log(lngvalues);
		add();


		
	}

	 function add() {

console.log(latvalues,lngvalues);
        

   // `addLatLng` takes a new latLng coordinate and puts it at the end of the
   // line. You optionally pull points from your data or generate them. Here
   // we make a sine wave with some math.
    
        polyline.addLatLng(
       L.latLng(latvalues[pointsAdded],lngvalues[pointsAdded]));

   // Pan the map along with where the line is being added.
   map.setView([latvalues[pointsAdded],lngvalues[pointsAdded]], 4);

   // Continue to draw and pan the map by calling `add()`
   // until `pointsAdded` reaches 360.
   if (++pointsAdded < 1000 & flag==true) window.setTimeout(add, speed);
}
}
	xmlhttp.send(null)
	return false;
}
    </script>

    <script>

       
      


  
        
        

        
  
    
        //add();
                
       


 
       

    </script>
   <button class="submit" type="button" id="txtHint"  >Change playback speed!</button>
    <script>

    console.log(speed);
    /*function changeSpeed()
    {
            speed=1000;
            if(flag==false)
            flag=true;
            if(flag==true)
            flag=false;
            console.log(speed);
            
    }*/
    </script>
  
<input type="text" id="text">
		<button class="submit" onClick="ajax_call()">Submit</button>
		
		
</body>
</html>